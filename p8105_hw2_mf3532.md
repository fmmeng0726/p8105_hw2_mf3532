P8105_HW2
================
Meng Fang
2022-09-19

## Problem 1

-   Data Cleaning

``` r
nyc_transit <- read_csv(file = "./NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% janitor::clean_names()
```

    ## Rows: 1868 Columns: 32
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (22): Division, Line, Station Name, Route1, Route2, Route3, Route4, Rout...
    ## dbl  (8): Station Latitude, Station Longitude, Route8, Route9, Route10, Rout...
    ## lgl  (2): ADA, Free Crossover
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
tidy_transit <- nyc_transit %>%
  select(2:18, 20, 23) %>%
  mutate(route8 = as.character(route8), route9 = as.character(route9), route10 = as.character(route10), route11 = as.character(route11)) %>%
  mutate(entry = ifelse(entry == "YES", TRUE, FALSE))

tidy_transit
```

    ## # A tibble: 1,868 × 19
    ##    line     station_name station_latitude station_longitude route1 route2 route3
    ##    <chr>    <chr>                   <dbl>             <dbl> <chr>  <chr>  <chr> 
    ##  1 4 Avenue 25th St                  40.7             -74.0 R      <NA>   <NA>  
    ##  2 4 Avenue 25th St                  40.7             -74.0 R      <NA>   <NA>  
    ##  3 4 Avenue 36th St                  40.7             -74.0 N      R      <NA>  
    ##  4 4 Avenue 36th St                  40.7             -74.0 N      R      <NA>  
    ##  5 4 Avenue 36th St                  40.7             -74.0 N      R      <NA>  
    ##  6 4 Avenue 45th St                  40.6             -74.0 R      <NA>   <NA>  
    ##  7 4 Avenue 45th St                  40.6             -74.0 R      <NA>   <NA>  
    ##  8 4 Avenue 45th St                  40.6             -74.0 R      <NA>   <NA>  
    ##  9 4 Avenue 45th St                  40.6             -74.0 R      <NA>   <NA>  
    ## 10 4 Avenue 53rd St                  40.6             -74.0 R      <NA>   <NA>  
    ## # … with 1,858 more rows, and 12 more variables: route4 <chr>, route5 <chr>,
    ## #   route6 <chr>, route7 <chr>, route8 <chr>, route9 <chr>, route10 <chr>,
    ## #   route11 <chr>, entrance_type <chr>, entry <lgl>, vending <chr>, ada <lgl>

the dataset contains 1868 rows and 19 columns. It contains variables:
line, station_name, station_latitude, station_longitude, route1, route2,
route3, route4, route5, route6, route7, route8, route9, route10,
route11, entrance_type, entry, vending, ada. The above cleaning
processes include: select desirable variables, change variables: route8,
rout9, route10 into character. and convert the entry variable from
character to logical variable.

-   number of distinct station

``` r
tidy_transit %>%
  distinct(line, station_name) %>%
  nrow()
```

    ## [1] 465

There are 465 distinct stations.

-   number of stations that are ada compliant

``` r
tidy_transit %>%
  filter(ada == TRUE) %>%
  distinct(line, station_name) %>%
  nrow()
```

    ## [1] 84

84 stations are ada compliant

-   proportion of station entrances / exits without vending

``` r
tidy_transit %>%
  filter(vending == "NO") %>%
  pull(entry)%>%
  mean()
```

    ## [1] 0.3770492

There are 37.7% of the stations entrances / exits without vending.

-   Number of stations serving A

``` r
tidy_transit %>% 
  pivot_longer(route1:route11, names_to = "route_num", values_to = "route") %>% 
  filter(route == "A") %>% 
  select(station_name, line) %>% 
  distinct() %>%
  nrow()
```

    ## [1] 60

60 stations serving line A

-   Number of stations serving A that are ADA compliant

``` r
tidy_transit %>% 
  pivot_longer(route1:route11, names_to = "route_num", values_to = "route") %>% 
  filter(route == "A", ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct() %>%
  nrow()
```

    ## [1] 17

17 serving A that are ADA compliant

## Problem 2

1)  Clean Mr.Trash Wheel Data

``` r
mr_tw <- read_excel("./Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N535") %>% janitor::clean_names()

tidy_mrtw <- mr_tw %>%
  mutate(sports_balls = as.integer(sports_balls)) %>%
  mutate(vessel_type = "Mr.Trash Wheel") %>%
  mutate(dumpster = as.integer(dumpster))%>%
  drop_na(dumpster)
```

    ## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

2)  Clean Professor Trash Wheel Data

``` r
prof_tw <- read_excel("./Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = "Professor Trash Wheel", range = "A2:N117") %>% janitor::clean_names()

tidy_proftw <- prof_tw %>%
  filter(!is.na(dumpster)) %>%
  mutate(sports_balls = as.integer(sports_balls)) %>%
  mutate(vessel_type = "Professor Trash Wheel")
```

3)  Bind 2 Data Together

``` r
tidy_tw <- bind_rows(tidy_mrtw,tidy_proftw)
```

Combining those two datasets, we have a combined dataset that contains
524 rows and 15 columns. There are in total 524 in the combined dataset.
An added `vessel_type` variable specifies the vessel that the
observation belongs to. some other key variables include: dumpster
number, month, year, date, weight, volume, different kinds of trash and
their amount, homes powered by trash-made electricity.

-   total weight of trash collected by professor trash wheel

``` r
tidy_tw %>%
  filter(vessel_type == "Professor Trash Wheel") %>%
  select(weight_tons) %>%
  sum()
```

    ## [1] 135.5

-   total number of sports balls collected by Mr. Trash Wheel in 2020

``` r
tidy_tw %>%
  filter(year == 2020, vessel_type == "Mr.Trash Wheel") %>%
  select(sports_balls) %>%
  sum()
```

    ## [1] 856

## Problem 3

1)  Clean pols-month.csv

``` r
pols_month <- read_csv(file = "./pols-month.csv") %>% janitor::clean_names()
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
tidy_pm <- pols_month %>%
  separate(mon, into = c("year","month","day"), sep = "-") %>%
  mutate(month = month.name[as.numeric(month)], year = as.integer(year)) %>%
  mutate(president = ifelse(prez_gop == 1, "Republican", "Democrat")) %>%
  select(-prez_gop,-prez_dem,-day)
```

2)  Second, clean the data in snp.csv using a similar process

``` r
snp <- read_csv(file = "./snp.csv") %>% janitor::clean_names()
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
tidy_snp <- snp %>%
  separate(date, into = c('month', 'day', 'year'), sep = '/') %>%
  mutate(year = as.integer(year),
         month = as.integer(month),
         day = as.integer(day)) %>%
  mutate(year = as.integer(ifelse(year <= 15, year + 2000, year + 1900))) %>%
  mutate(month = month.name[as.numeric(month)]) %>%
  select(year, month, close)
```

3)  Third, tidy the unemployment data so that it can be merged with the
    previous datasets

``` r
unemploy <- read_csv(file = "./unemployment.csv") %>% janitor::clean_names()
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
tidy_unemploy <- unemploy %>%
  pivot_longer(2:13, names_to = "month", values_to = "unemploy_perc") %>%
  mutate(month = recode(month,
                        'jan' = 'January', 
                        'feb' = 'February', 
                        'mar' = 'March', 
                        'apr' = 'April', 
                        'may' = 'May', 
                        'jun' = 'June', 
                        'jul' = 'July', 
                        'aug' = 'August', 
                        'sep' = "September", 
                        'oct' = 'October', 
                        nov = 'November', 
                        dec = 'December'), 
         year = as.integer(year))
```

4)  Combine all three dataset together

``` r
combined_df <-  merge(tidy_pm, tidy_snp) %>% merge(tidy_unemploy)
```

Combining those three datasets, and dropping missing values for each
variable, we have a combined dataset that contains 786 rows and 11
columns. There are in total 786 in the combined dataset., the range of
years is: 65. Some key variables include:

-   year
-   month
-   gov_gop: the number of republican governors on the associated date
-   sen_gop: the number of republican senators on the associated date
-   rep_gop: the number of republican representatives on the associated
    date
-   gov_dem: the number of democratic governors on the associated date
-   sen_dem: the number of democratic senators on the associated date
-   rep_dem: the number of democratic representatives on the associated
-   president: the party of the president on the associated date
-   close: the closing values of the S&P stock index on the associated
    date
-   unemploy_perc: the unemployment percentage on the associated date
